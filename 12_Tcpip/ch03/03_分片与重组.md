
### 分片

理想情况下，整个数据报被封装在一个物理帧中，使物理网络上的传输非常有效。事实却是：每种分组交换技术都对一个物理帧可传输的数据量规定了一个固定上界，称为网络最大传输单元或 MTU(比如以太网 MTU 为 1500 个字节)。

在 MTU 较小的网络上，可以把长数据报通过分片操作划分成更小块的数据报片。分片通常发生在路由器上，数据报分片的大小必须是 8 的倍数。

为了产生原始数据报的完整副本，在目的站处理之前必须对收到的数据报分片进行重组。

IP 协议并不把数据报限制到很小，但也不保证大的数据报交付时不被分片。源站可以任意选择合适的数据报大小，分片和重组自动进行，源站不必采取任何特殊动作。

数据报分片后的每片格式都与原来的数据报相同。每个数据报片都包含一个数据报首部，该首部基本复制了原始数据报的首部，首部后面是数据报片携带的数据，同时让数据报片的总长度始终保持小于传输它的底层网络的 MTU 大小。


### 重组

经过分片之后的 IP 数据报在被重组的时候，只能在目标主机进行。

路由器虽然会进行分片但不会进行重组。之所以这样做原因有如下几点:
* 无法保证同一 IP 数据报内的不同分片一定通过同一个路由传送。这样，即便等待很久，也无法完成重组。
* IP 无法保证可靠交付，而路由器也并不在上层提供对 IP 数据报的可靠交付检查。如果分片丢失，重组没有意义。
* 即使在途中某一处被重组，但如果下一站再经过其他路由时还会面临被分片的可能。这会给路由器带来多余的负担，也会降低网络传送效率。

目的主机从它收到初始片开始时启动一个重组计时器，若在所有分片到达之前超时，则丢弃已收到的分片，不处理数据报。


### 报文与分片控制

数据报首部中的标识、标志、片偏移量控制着数据报的分片和重装。

目的主机通过标识字段和源站地址识别数据报片属于哪个数据报。

数据报片的片偏移量字段指明数据报片所携带数据在原始数据报中的偏移量(以8比特为单位)。

存放控制比特位，包括指明数据报是否可分片、是否是原始数据报的尾部等。


### 路径 MTU 发现

分片机制也有它的不足。
* 首先，路由器的处理负荷加重。随着时代的变迁，计算机网络的物理传输速度不断上升。这些高速的链路，对路由器和计算机网络提出了更高的要求。另一方面，随着人们对网络安全的要求提高，路由器需要做的其他处理也越来越多，如网络过滤等。因此，只要允许，是不希望由路由器进行 IP 数据包的分片处理的。
* 其次，在分片处理中，一旦某个分片丢失，则会造成整个 IP 数据报作废。为了避免此类问题，TCP 的初期设计还曾使用过更小的分片进行传输，不过这样的话网络带宽的利用率明显下降。

为了应对以上问题，产生了一种新的技术"路径MTU发现"(Path MTU Discovery)。所谓路径MTU(Path MTU)是指从发送端主机到接收端主机之间不需要分片时最大 MTU 的大小，即路径中存在的所有数据链路中最小的MTU。

路径 MTU 发现在发送主机上按照路径 MTU 的大小将数据报分片后再进行发送。这样就可以避免在中途的路由器上进行分片处理。
