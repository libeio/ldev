
TCP 通过检验和、序列号、确认应答、重传以及窗口控制等实现可靠性传输。


### 确认应答与重传 序列号

在 TCP 中，当发送端的数据到达接收主机时，接收端主机会返回一个已收到消息的通知。这个消息叫做确认应答(ACK)。TCP 通过肯定的确认应答(ACK)实现可靠的数据传输。当发送端将数据发出之后会等待对端的确认应答。如果有确认应答，说明数据已经成功到达对端。反之，则数据丢失的可能性很大。

TCP 的确认应答处理、重传控制都是基于序列号实现的。序列号是按顺序给发送数据的每一个字节(称为八位组更合适些)都标上号码的编号。接收端查询接收数据 TCP 首部中的序列导和数据的长度，将自己下一步想要接收的序列号作为确认应答返送回去。这样，通过序列号和确认应答号，TCP 就实现了可靠传输。

TCP 在两种情况下会进行消息的重传:
1. 如果在一定时间内发送端没有等到确认应答，发送端就认为数据已经丢失，并进行重传。
2. 接收端虽然可能已经收到数据，但返回的确认应答在途中丢失，发送端也会重传。此时，接收端将第二次发送已接收此数据的确认应答。不过由于接收端之前已经收到同样数据，当再有相同数据送达时它会丢弃。

需要注意的是，数据也不会被无限、反复地重传。达到一定重传次数之后，如果仍没有任何确认应答返回，就会判断为网络或对端主机发生了异常，强制关闭连接，并且通知应用通信异常强行终止。


### 重传超时

无论是上面哪种情况下的重传，都是通过重传超时进行控制的。

重传超时是指在重发数据之前，等待确认应答到来的那个特定时间间隔。如果超过了这个时间仍未收到确认应答，发送端将进行数据重传。

重传超时的确定
* 最理想的是，找到一个最小时间，它能保证"确认应答一定能在这个时间内返同"。然而这个时间长短随着数据包途径的网络环境的不同而有所变化。
* TCP 要求不论处在何种网络环境下都要提供高性能通信，并且无论网络拥堵情况发生何种变化，都必须保持这一特性。为此，它在每次发包时都会计算往返时间及其偏差。将这个往返时间和偏差加上重传超时的时间，就是比这个总和要稍大一点的值。
* 之所以考虑偏差是因为数据包的分段可能是经过不同路由到达的，这会造成往返时间的抖动。
