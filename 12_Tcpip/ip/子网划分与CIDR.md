
## 原始的 ip 编址思想
- 第 3 层的逻辑地址用于建立层次结构型网络，从而可以划分特定的网段来隔离网络流量。
- IP 地址并不标识某台机器，而是标识一台主机与网络的一个连接。
- 在分类编址中，IP 地址空间共分为 5 类: A B C D E 类。这些地址类可以通过其引导(最高顺序)位
  进行区分。
    + A 类: 有一个其值为 0 的引导位，一个 7 位的网络号和一个 24 位的本地主机地址。
    + B 类: 有两个其值设为 1-0 的最高顺序位(引导位)，一个 14 位的网络号和一个 16 位的本地主
      机地址。
    + C 类: 有三个其值设为 1-1-0 的引导位，一个 21 位的网络号和一个 8 位的本地主机地址。
    + D 类: 有四个最高顺序位(引导位)被设置为 1-1-1-0, 其余 28 位表示多播组。
    + E 类: 有五个最高顺序位(引导位)被设置为 1-1-1-1-0, 是预留将来使用的地址。
- 编址规则
    + IP 地址中定义主机部分的位不能全是 "1"。
    + IP 地址中定义网络部分的位不能全是 "0"。
    + A 类网络号 127 被指定用于"回送测试"功能。
    + 专用或预留地址，也称为私网地址
      ```shell
        类别   地址范围                        网络数    每个网络中的主机数量
        A      10.0.0.0 ~ 10.255.255.255       1         2^24 - 2
        B      172.16.0.0 ~ 172.31.255.255     16        2^16 - 2
        C      192.168.0.0 ~ 192.168.255.255   256       2^8 - 2
      ```

----

## 当前的 ip 编址思想 - 子网划分
- 子网划分的一般方法是，通过对原始网络地址中主机地址部分的借位来生成子网地址部分，即将 IP
  地址的主机号再次划分为子网地址与主机地址两个部分，一部分用来标识子网，另一部分仍然作为主
  机号。
- 这种子网编址方案，实际上是选择如何把 IP 地址的主机号划分成子物理网络和新的主机号。
- 带掩码的子网划分实现
    + 为要划分成的每个 IP 地址类分配一个默认的子网网络掩码。
    + 通过对二进制的网络地址和其网络掩码进行"逻辑与"运算，网络设备可以区分网络地址的网络部分
      和主机部分。
    + 具体实现是: 如果网络上的机器把IP地址中的一些比特看成是网络前缀的部分，则子网掩码中那些
      对应的比特就被置为"1"；而如果把一些比特看成是主机标识符的部分，则把它们置为"0"。
  
## 最大可用子网数和主机数
- 在向主机部分借位时，必须至少保留 2 个主机位。因为在默认地址的网络中，最大主机数量是
  "2^主机部分位数 - 2"。所以在借位时必须为每个子网中留下至少 2^2 个主机地址。
- 每个子网的最大主机数依赖于建立的子网数。
- 可用的子网数要比允许的最大子网数少 2。其原因在于，有类别间域路由选择协议无法区分全 0 子网
  (子网部分全为0)和默认网络地址。有类别域间路由器也无法区分全 1 子网的地址和默认的广播地址。
  因此，当借位数为 1 时，没有可用的子网(2 - 2 = 0)。
- 在借位时必须为主机保留 2 位，以便减去网络地址和广播地址后，仍有最少两个可用主机。因此不能
  借 7 位。

## IP 广播地址
- IP 地址中的网络和/或主机部分的位值不能全为 1。如果全为 1，则代表广播地址，这种特殊用途的地
  址用于同时向多个目的网络或主机传送数据。IP 广播地址有下列 4 种类型:
    + 有限广播地址: 
      地址设为 255.255.255.255。有限广播地址通常用于配置主机的启动信息。例如，当主机从 DHCP 
      服务器获取 IP 地址时。
    + 非定向广播地址: 
      地址形式为 netid.255.255.255。网络使用非定向广播地址向特定网段上的所有主机发送数据包。
    + 子网定向广播地址: 
      限于表示特定子网上的主机。
    + 全部子网定向广播地址: 
      基本不再使用，已由 D 类多播地址所取代。
- 有限 IP 广播永远都不能通过路由器，而只能通过中继器和媒体访问控制(MAC)层的网桥等设备。
- 定向广播包括非定向广播和子网定向广播。定向 IP 广播数据包可以通过路由器，并广播到目标网络
  的所有主机。
  
----

## 无类别域间路由(CIDR)
- 路由的概念
    + 因特网是一个松散的由半自治网络(ISP和运营商)组成的联合体，其中的每个网络均有自己的动作
      方案、服务内容和用户，并自主选择用于建立网络服务的多种组件的安全性解决方案。
    + 路由器为因特网提供数据包交换主干，其数据包支持方案的选择也建立在其服务端的动作规则基
      础之上。
    + IP 地址空间将这些独立的网络连接在一起成为一个整体。路由选择协议，如用于自治系统内部的
      内部网关路由协议(IGRP)和用于自治系统之间的外部网关协议(EGP)，用于确定路由器如何在网段
      之间传送数据包。
    + 路由器利用路由表来确定在网络之间传送数据包的最佳路径。路由表由路由选择协议建立。
- CIDR 的主要作用
    + 路由器路由表条目最大理论数量是 60000 条。但对于大多数机构或团体来说，默认 B 类地址所
      提供的地址范围通常会超出其需要，而 C 类地址所提供的地址数量又太少，无法满足其需要。如
      果选择 B 类地址，会造成很多地址闲置不用。
    + CIDR 可用于解决上面的两个问题。
    + CIDR 支持地址的汇总或汇聚。在地址汇聚方法中，网络供应商在被分配了**地址连续**的 C 类
      地址块后，又将这些地址块再次分配给他们的用户。此时网络供应商只需要通告通往汇聚块网络
      地址的路由，而非独立的用户地址。至于内部地址如何划分，则由用户决定。
    + 机构或团体可以使用连续的 C 类地址来代替单一的 B 类地址，从而有效地满足其主机地址的需
      求。CIDR 将这些连续的地址视为一个单一的汇聚起来的超级网络。
- CIDR 的工作过程
    + CIDR 建立于"超级组网"的基础之上，"超级组网"是"子网划分"的派生词，可看作子网划分的逆过
      程。
    + 子网划分时，从地址的主机部分借位，然后将其合并进网络部分；而在超级组网中，则是将网络
      部分的某些位合并进主机部分。这种无类别超级组网技术通过将一组较小的无类别网络的路由信
      息汇聚为一个较大的单一路由表项，减少了因特网路由域中路由表条目(项)的数量。
- CIDR 记法
    + CIDR 记法用一个十进制数表示掩码的长度，并使用一个斜线把它和地址隔开。这样，采用CIDR记
      法的地址块可以这样写:
      ```shell
        128.211.168.0/21
      ```

----
    
## 各类网络的子网划分示例  
- C 类网络划分示例
以 IP 地址为 194.120.36.35, 借 3 位的情形为例。
    + 该 IP 地址属于: C 类
    + 该类地址最多允许借: 6 位
    + 该类地址中有多少个八位位组用于指定网络部分? 3 个
    + 该类地址中有多少个八位位组用于指定主机部分? 1 个
    + 该类地址允许的最大主机数是: 256
    + 该 IP 地址的子网掩码是: 255.255.255.224
    + 子网的 IP 前缀是: /27
    + 该子网掩码允许的最大子网数是: 8
    + 在该子网掩码网络中，每个子网允许的最大主机数是: 32
    + 可用子网数是: 6
    + 每个子网的可用主机数是: 30
    + 该网络中所有子网可用的主机总数是: 180
    + 该 IP 地址所在子网的网络号（网络地址）是: 194.120.36.32
    + 该 IP 地址所在子网的广播地址是: 194.120.36.63
    + 网络中前两个子网的地址范围:
      ```shell
        194.120.36.0 ~ 194.120.36.31(不可用)
        194.120.36.32 ~ 194.120.36.33
      ```
    + 网络中最后两个子网的地址范围:
      ```shell
        194.120.36.192 ~ 194.120.36.223
        194.120.36.224 ~ 194.120.36.225(不可用)
      ```
- B 类网络划分示例
以 IP 地址为 175.25.250.62, 借 6 位的情形为例。
    + 该 IP 地址属于: B 类
    + 该类地址最多允许借: 14 位
    + 该类地址中有多少个八位位组用于指定网络部分? 2 个
    + 该类地址中有多少个八位位组用于指定主机部分? 2 个
    + 该类地址允许的最大主机数是: 65536
    + 该 IP 地址的子网掩码是: 255.255.252.0
    + 子网的 IP 前缀是: /22
    + 该子网掩码允许的最大子网数是: 64
    + 在该子网掩码网络中，每个子网允许的最大主机数是: 1024
    + 可用子网数是: 62
    + 每个子网的可用主机数是: 1022
    + 该网络中所有子网可用的主机总数是: 63364
    + 该 IP 地址所在子网的网络号（网络地址）是: 175.25.248.0
    + 该 IP 地址所在子网的广播地址是: 175.25.251.255
    + 网络中前两个子网的地址范围:
      ```shell
        172.25.0.0 ~ 172.25.3.255(不可用)
        172.25.4.0 ~ 172.25.7.255
      ```
    + 网络中最后两个子网的地址范围:
      ```shell
        172.25.248.0 ~ 172.25.251.255
        172.25.252.0 ~ 172.25.255.255(不可用)
      ```
- A 类网络划分示例
以 IP 地址为 125.225.198.93, 借 21 位的情形为例。
    + 该 IP 地址属于: A 类
    + 该类地址最多允许借: 22 位
    + 该类地址中有多少个八位位组用于指定网络部分? 1 个
    + 该类地址中有多少个八位位组用于指定主机部分? 3 个
    + 该类地址允许的最大主机数是: 16777216
    + 该 IP 地址的子网掩码是: 255.255.255.248
    + 子网的 IP 前缀是: /29
    + 该子网掩码允许的最大子网数是: 2097152
    + 在该子网掩码网络中，每个子网允许的最大主机数是: 8
    + 可用子网数是: 2097150
    + 每个子网的可用主机数是: 6
    + 该网络中所有子网可用的主机总数是: 12582900
    + 该 IP 地址所在子网的网络号（网络地址）是: 125.225.198.88
    + 该 IP 地址所在子网的广播地址是: 125.225.198.95
    + 网络中前两个子网的地址范围:
      ```shell
        125.0.0.0 ~ 125.0.0.7(不可用)
        125.0.0.8 ~ 125.0.0.15
      ```
    + 网络中最后两个子网的地址范围:
      ```shell
        125.255.255.240 ~ 125.255.255.247
        125.255.255.248 ~ 125.255.255.255(不可用)
      ```


