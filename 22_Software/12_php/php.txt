//	php-7.2.3.tar.gz

//	参考 
	Linux 系统安装配置PHP服务(源码安装)
	https://www.cnblogs.com/zoulongbin/p/6379272.html
	配置Nginx来支持php
	https://www.cnblogs.com/jecyhw/p/5504855.html
	
//	依赖库
	//	安装yasm-1.3.0.tar.gz
		./configure
		make && make install
	//	安装libmcrypt-2.5.8
		./configure
		make && make install
	//	安装libvpx-1.7.0.tar.gz		安装失败！！！但不影响后续php的安装
		./configure --prefix=/usr/local/libvpx --enable-shared --enable-vp9
		make && make install
	//	安装tiff-4.0.9.tar.gz
		./configure --prefix=/usr/local/tiff --enable-shared
		make && make install
	//	安装freetype-2.7.1.tar.gz
		./configure --prefix=/usr/local/freetype --enable-shared
		make && make install
	//	安装jpegsrc.v9c.tar.gz
		cd jpeg-9c
		./configure --prefix=/usr/local/jpeg --enable-shared
		make && make install
	//	安装libgd-2.2.5
		./configure --prefix=/usr/local/libgd --enable-shared --with-jpeg=/usr/local/jpeg --with-png=/usr/local/libpng --with-freetype=/usr/local/freetype --with-fontconfig=/usr/local/freetype --with-tiff=/usr/local/tiff
		make && make install
	
//	安装php
	1.解压并进入解压目录
		tar -zxvf php-7.2.3.tar.gz
		cd php-7.2.3
	2.检测依赖项（需要安装libxml2-devel）
		./configure --prefix=/usr/local/php --with-config-file-path=/usr/local/php/etc --with-pdo-mysql=/usr/local/mysql --with-mysqli=/usr/local/mysql/bin/mysql_config --with-mysql-sock=/tmp/mysql.sock --with-pdo-mysql=/usr/local/mysql --with-gd --with-png-dir=/usr/local/libpng --with-jpeg-dir=/usr/local/jpeg --with-freetype-dir=/usr/local/freetype --with-iconv --enable-libxml --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --enable-opcache --enable-mbregex --enable-fpm --enable-mbstring --enable-ftp --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --without-pear --with-gettext --enable-session --with-curl --enable-ctype --enable-fpm
		另一种没有试过的（支持openssl的）：
		//参考：curl+openssl编译
		//链接：https://www.cnblogs.com/huzz/p/5919772.html
		./configure '--prefix=/usr/local/php' '--enable-fpm' '--enable-mbstring' '--enable-soap' '--enable-bcmath' '--enable-sockets' '--enable-zip' '--with-openssl=/usr/local/openssl' '--with-libxml-dir=/usr/local/libxml2' '--with-curl=/usr/local/curl' '--with-pcre-dir=/usr/local/pcre' '--with-zlib-dir=/usr/local/zlib' '--with-freetype-dir=/usr/local/freetype2' '--with-png-dir=/usr/local/libpng' '--with-jpeg-dir=/usr/local/jpeg' '--with-gd=/usr/local/libgd' '--with-xpm-dir=/usr/local/libxpm' '--with-mysql' '--with-mysqli'
		最近一次配置
		./configure --prefix=/usr/local/php --with-config-file-path=/usr/local/php/etc --with-gd=/usr/local/libgd --with-png-dir=/usr/local/libpng --with-openssl-dir=/usr/local/openssl --with-jpeg-dir=/usr/local/jpeg --with-freetype-dir=/usr/local/freetype --with-iconv --enable-libxml --enable-xml --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --enable-opcache --enable-mbregex --enable-fpm --enable-mbstring --enable-ftp --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --without-pear --with-gettext --enable-session --enable-ctype --enable-fpm --with-xpm-dir=/usr/lib64

		--with-curl=/usr/local/curl
		--with-pdo-mysql=/usr/local/mysql --with-mysqli=/usr/local/mysql/bin/mysql_config --with-mysql-sock=/tmp/mysql.sock --with-pdo-mysql=/usr/local/mysql
		
	3.编译并安装
		make && make install
	
//	配置php
	1.复制php配置文件到安装目录
		cp /usr/local/src/php-7.2.3/php.ini-production /usr/local/php/etc/php.ini
	2.删除系统自带配置文件
		mv /etc/php.ini /etc/php.ini.system-own.bak
	3.添加软链接到/etc目录
		ln -s /usr/local/php/etc/php.ini /etc/php.ini
	4.复制模板文件为php-fpm配置
		cp /usr/local/php/etc/php-fpm.conf.default  /usr/local/php/etc/php-fpm.conf
	5.复件模板文件为www.conf配置
		cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf
	6.添加软件链接到 /etc目录 
		ln -s /usr/local/php/etc/php-fpm.conf  /etc/php-fpm.conf
	7.修改配置文件
		vim /usr/local/php/etc/php-fpm.conf
			去掉注释 pid = run/php-fpm.pid
			去掉注释 user = www
			去掉注释 group = www
		注意： 如果这些选项在配置文件存在就取消掉注释使用，如果不存在可以忽略，请勿手动添加，否则PHP启动会报错。
		vim /usr/local/php/etc/php-fpm.d/www.conf
			去掉注释 user = www
			去掉注释 group = www
	
//	设置php-fpm开机启动
	1.复制php-fpm到启动目录
		cp /usr/local/src/php-7.2.3/sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm
	2.赋予php-fpm执行权限
		chmod 755 /etc/init.d/php-fpm
	3.设置php-fpm开机启动
		chkconfig php-fpm on
		chkconfig --list php-fpm
	4.编辑php配置文件php.ini
		vim /usr/local/php/etc/php.ini
			disable_functions = 修改为
				disable_functions= passthru,exec,system,chroot,scandir,chgrp,chown,shell_exec,proc_open,proc_get_status,ini_alter,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,stream_socket_server,escapeshellcmd,dll,popen,disk_free_space,checkdnsrr,checkdnsrr,getservbyname,getservbyport,disk_total_space,posix_ctermid,posix_get_last_error,posix_getcwd,posix_getegid,posix_geteuid,posix_getgid,posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid,posix_getppid,posix_getpwnam,posix_getpwuid, posix_getrlimit,posix_getsid,posix_getuid,posix_isatty, posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid, posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname
			date.timezone =	修改为
				date.timezone = PRC	#设置时区
			expose_php = On	修改为
				expose_php = Off	#禁止显示php版本信息
			short_open_tag = Off 修改为
				short_open_tag = On	#支持php短标签
			opcache.enable = 0	修改为
				opcache.enable = 1	#php支持opcode缓存
			opacache.enable_cli = 1 修改为
				opcache.enable_cli = 0 #php支持opcode缓存
			在最后一行添加
				zend_extension = opcache.so	#开启opcode缓存功能 (在文本按Shift+G就能跳到最后一行)

//	配置nginx支持php
	1.添加 www 用户和 www 组
		useradd www
		group -g www www
	2.修改nginx.conf配置文件
		vim /usr/local/nginx/conf/nginx.conf
		user www www;	#首行user去掉注释,修改Nginx运行组为www www；必须与/usr/local/php/etc/php-fpm.d/www.conf中的user,group配置相同，否则php运行出错
		location / {
				root   /data/www/;
				index  index.html index.htm index.php;         #添加index.php
		}
		location ~ \.php$ {
				root           /data/www/;
				fastcgi_pass   127.0.0.1:9000;
				fastcgi_index  index.php;
				fastcgi_param  SCRIPT_FILENAME /data/www/$fastcgi_script_name;
		#		fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
				include        fastcgi_params;
		}
	3.启动nginx服务和php服务
		/etc/init.d/nginx restart
		/etc/init.d/php-fpm start
	4.开放9000端口
	iptables -I INPUT -p tcp --dport 80 -j ACCEPT
