
### 长连接

HTTP 协议的初始版本中，每进行一次 HTTP 通信就要断开一次 TCP 连接。事实上，与正常的数据传输相比，TCP 的连接建立与断开是一件很耗时的事情。

为此，HTTP/1.1 引入长连接概念(HTTP Persistent Connections)，也称为 HTTP keep-alive 。长连接的特点是，只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。

长连接减少了 TCP 连接的重复建立和断开所造成的时间开销与服务器端资源负载消耗，提高了请求与响应的速度。

在 HTTP/1.1 中，所有的连接默认都是长连接。当然，这需要通信的双方均在 HTTP/1.1 版本下运行。


长连接下对数据的处理:
* HTTP 长连接对数据的处理，类似于直接使用 TCP 对数据的处理。
* HTTP 基于 TCP 流协议。长连接情况下， HTTP 通过协议规则来分割数据包，每个数据包由首部和实体组成。先获取首部，从中得到 `Content-Length`，然后获取 Content(也可以根据某标记获取)。就这样从流中拿到一个个相对独立的数据包进行处理。


长连接的关闭与超时后维持:
* HTTP 一般都是服务端先主动关闭(因为只有它知道自己提供的服务是否完毕)。但长连接情况下，服务端一般不主动关闭，而是通过判断是否超时来进行关闭。
* 长连接情况下，服务端有超时设置。如果超过设定时间内没有新的请求到来就关闭连接。超时时长由自己设定，HTTP 的长连接应该是短暂的，比如 1 秒。考虑到网速问题，可以设置为 5 秒。
* 超时后如果不想关闭这个长连接，可以发送心跳包维持。


### 管线化

长连接使得多数请求以管线化(pipelining)方式发送成为可能。

从前发送请求后需等待并收到响应后才能发送下一个请求，管线化技术使得请求端不用等待响应亦可直接发送下一个请求。这样就能够做到同时并行发送多个请求，而不需要一个接一个地等待响应了。

使用管线化技术时，其请求数越多，时间差与不使用管线化的差距就越明显。

管线化技术对不同请求写服务器端同一个资源时的处理并不友好，目前多应用于获取资源，如 GET 方法中。
