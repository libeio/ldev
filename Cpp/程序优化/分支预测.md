
*X86: 这群傻瓜。*

*ARM: 我看好你们。*


### 概念: 处理器流水线

现代处理器将指令操作划分为许多不同的阶段，每个阶段由某个单元执行，这样存在多个操作在处理器的多个单元上像水流一样向前流动，这称为"流水线执行"。每个水流就称为一个流水线。

流水线(pipeline)是一串操作的集合，其中前一个操作的输出是下一个操作的输入。


### 分支预测

当处理器遇上分支指令(判断指令，如 if)的时候，有两种选择:

- 直接执行下一条指令，如果分支是循环的判断条件，则这很有可能造成处理器的流水线中断。

- 选择某条分支执行，一旦选择错误，处理器就需要丢弃已经执行的结果，且从正确的分支开始执行。

这种选择哪个分支的过程称为"分支预测"。

如果程序中带有许多循环，且循环计数都比较小，或者面向对象的程序中带有许多虚函数的对象(每个对象都可以引用不同的虚函数实现)，此时处理器很难或者完全不可能预测某个分支的走向。由于此时程序的控制流不可预测，处理器会因大概率预测失败而不得不频繁等待预测失败的流水线被清空或等待被新指令填充，这将大幅降低处理器的性能。

关于分支预测，不同的处理器展现出完全不同的态度，比如 X86 就极力地优化其分支预测器的性能，而 ARM 和主流的 GPU 则要保守得多。