
## 线程安全

当多个线程同时访问一个对象时，如果不用考虑这些线程在运行时环境下的调度和交替执行，也不需要进行额外的同步，或者在调用方进行任何其他的协调操作，调用这个对象的行为都可以获得正确的结果，那就称这个对象是线程安全的。

## 共享数据如何实现线程安全

访问共享数据时使用同步
- 加锁
- 使用原子变量

不共享数据
- volatile
- 线程局部存储，防止变量全局共享

共享数据不可变
- 只读

## 什么时候使用 volatile 关键字
- volatile 关键字是用来确保在共享数据更新后及时的通知到其他线程的，即**任一线程都会从内存中直接读取 volatile 所修饰的变量**。但这样并不能保证某个线程对变量的操作是原子性的，比如:
  ```c
    volatile int i = 0;

    i++;
  ```
  程序一共需要执行读取i, 计算i，再更新i三个操作。但如果这个过程中i的值被其他线程改变，那么这个计算结果最终会覆盖前面的值而造成错误的结果，所以这种操作仍然需要靠锁来控制。

  也就是说， **volatile 能保证变量的可见性，而加锁能保证变量的可见性和原子性**。

- volatile 应用
    + 共享变量只能被一个线程拥有和修改。即一个线程可以写，但其他线程的线程只能读。此时可以不对此共享变量加锁。
